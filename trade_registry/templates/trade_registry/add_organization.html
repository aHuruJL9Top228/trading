
{% extends "trade_registry/wrapper.html" %}
{% load static %}

{% block content %}
<div class="block-main-content">
    <h2 class="title-part">Добавление организации</h2>

    <form method="post" id="org-form">
        {% csrf_token %}

        <!-- Основные поля формы (скрываем linked_objects) -->
        {% for field in form %}
            {% if field.name != 'linked_objects' %}
                <p>
                    {{ field.label_tag }}
                    {{ field }}
                <p>
            {% endif %}
        {% endfor %}

        <!-- Поле для автокомплита -->
        <div class="add-trading-obj">
            <label>Выберите объекты (принадлежащие организации):</label>
            <select id="object-select" multiple placeholder="Начните вводить название...">
                {% if form.linked_objects.value %}
                    {% for obj in form.linked_objects.field.queryset.all %}
                        {% if obj.id in form.linked_objects.value %}
                            <option value="{{ obj.id }}" selected>{{ obj.object_name }}</option>  {# Изменено name → object_name #}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </select>
            <!-- Скрытое поле для хранения значений -->
            <select id="real-linked-objects" name="linked_objects" multiple class="d-none"></select>
        </div>

        <button type="submit" class="button-save">Сохранить</button>
    </form>
</div>

{% endblock %}

